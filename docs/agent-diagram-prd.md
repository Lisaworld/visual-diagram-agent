# Visual Thinking Agent Diagram PRD

## 📌 프로젝트 개요
Visual Thinking Diagram Agent는 자연어 입력을 다양한 형태의 다이어그램(플로우차트, 마인드맵, 트리)으로 변환하고 편집할 수 있도록 돕는 인터랙티브 도구입니다.

## ✅ 단계별 구성 (0~6단계)

### 0단계: 프로젝트 설계 및 PRD 작성 [완료]
- [x] 기능 정의, 기술 스택, UX 흐름, 테스트 계획 포함
- [x] 문서: `agent-diagram-prd.md`, `development-guidelines.md`, `testing-guidelines.md`
- [x] 상세 설계 문서 작성 및 프로젝트 구조 정의

### 1단계: 기본 UI 및 상태관리 구성 [완료]
- [x] InputBox 컴포넌트 구현
  - 사용자 입력 처리 및 유효성 검사
  - 키보드 단축키 지원 (⌘/Ctrl + Enter)
  - 로딩 상태 및 에러 표시
- [x] AgentContextProvider 구현
  - 전역 상태 관리
  - 사용자 입력 상태 관리
  - 도식 데이터 상태 관리
- [x] 테스트 케이스 작성
  - 컴포넌트 단위 테스트
  - 상태 관리 테스트

### 2단계: 도식 데이터 생성 [완료]
- [x] 도식 데이터 구조 정의
  - 공통 포맷: nodes, edges
  - 각 도식 타입별 특성 반영
- [x] Mock 데이터 생성 로직
  - 흐름도(flowchart) 데이터 생성
  - 마인드맵(mindmap) 데이터 생성
  - 계층도(tree) 데이터 생성
- [x] 데이터 변환 및 검증 로직
  - 타입 안전성 확보
  - 데이터 구조 검증

### 3단계: Konva.js 기반 도식 에디터 [완료]
- [x] EditableDiagram 컴포넌트 구현
  - Stage, Layer 구조 설정
  - 노드 및 엣지 렌더링
- [x] DiagramRenderer 컴포넌트 구현
  - 노드 텍스트 수정 기능
  - 노드 드래그 기능
  - 엣지 자동 업데이트
- [x] 테스트 케이스 작성
  - react-konva 모킹
  - 사용자 상호작용 테스트
  - 렌더링 테스트

### 4단계: ADK 기반 에이전트 구현 [완료]
- [x] 에이전트 타입 정의
  - AgentMemory (대화/다이어그램 기록, 컨텍스트)
  - AgentTool (도구 인터페이스)
  - AgentState (상태 관리)
  - AgentAction (액션 타입)
- [x] DiagramAgent 클래스 구현
  - 상태 관리 및 도구 등록
  - 입력 처리 및 다이어그램 생성
  - 컨텍스트 업데이트
  - 에러 처리
- [x] AgentContextProvider 통합
  - DiagramAgent 인스턴스 관리
  - 상태 동기화
  - 사용자 인터페이스 연동
- [x] 테스트 케이스 작성
  - 초기화 테스트
  - 입력 처리 테스트
  - 에러 처리 테스트
  - 상태 관리 테스트

### 5단계: 고급 기능 구현 [진행 중]
- [진행 중] 도식 스타일 커스터마이징
  - 노드 스타일 설정 [구현 완료]
    - 색상 선택
    - 크기 조절
    - 테두리 스타일
  - 엣지 스타일 설정 [구현 완료]
    - 선 스타일 (실선/점선)
    - 화살표 스타일
    - 색상 선택
  - 테마 프리셋 [구현 완료]
    - 라이트/다크 모드
    - 사용자 정의 테마
    - 테마 저장/불러오기
- [ ] 도식 내보내기/가져오기
  - JSON 형식 저장/불러오기
  - PNG/SVG 이미지 내보내기
  - 클립보드 복사/붙여넣기
- [ ] 실시간 협업 기능
  - 공유 링크 생성
  - 실시간 편집
  - 변경 내역 동기화
- [ ] 히스토리 관리
  - 실행 취소/다시 실행
  - 변경 이력 추적
  - 버전 관리

## 🔧 현재 구현된 기능

### 입력 처리
- [x] 자연어 입력 UI
- [x] 키보드 단축키
- [x] 로딩 상태 표시
- [x] 에러 처리

### 도식 생성
- [x] OpenAI API 통합
- [x] 3가지 도식 형식 지원
- [x] JSON 응답 처리

### 도식 편집
- [x] 노드 드래그 앤 드롭
- [x] 텍스트 수정
- [x] 실시간 업데이트

### 에이전트 시스템
- [x] 상태 관리
- [x] 도구 통합
- [x] 메모리 관리
- [x] 컨텍스트 관리

### 스타일 커스터마이징
- [x] 테마 시스템 구현
  - 기본 테마 (라이트 모드)
  - 다크 테마
  - 사용자 정의 테마 지원
- [x] 노드 스타일링
  - 색상, 크기, 테두리 설정
  - 폰트 스타일 설정
  - 패딩 조절
- [x] 엣지 스타일링
  - 선 색상 및 두께
  - 화살표 크기
  - 점선 스타일

## 🚀 다음 단계 계획

### 기능 확장
- [ ] 도식 내보내기/가져오기 기능
- [ ] 실시간 협업 시스템
- [ ] 히스토리 관리 시스템

### UI/UX 개선
- [ ] 반응형 디자인 개선
- [ ] 접근성 향상
- [ ] 성능 최적화

## 🔄 설치 및 실행

```bash
# 의존성 설치
npm install --legacy-peer-deps

# 환경 변수 설정
# .env 파일 생성 후 아래 내용 추가
REACT_APP_OPENAI_API_KEY=your_api_key_here

# 개발 서버 실행
npm run dev

# 테스트 실행
npm test
```

## 📁 프로젝트 구조
```
src/
  ├── components/
  │   ├── InputBox.tsx          # 입력 처리 컴포넌트
  │   ├── EditableDiagram.tsx   # 도식 편집 컴포넌트
  │   ├── DiagramRenderer.tsx   # Konva.js 렌더링 컴포넌트
  │   └── __tests__/           # 컴포넌트 테스트
  ├── contexts/
  │   └── AgentContextProvider.tsx  # 상태 관리
  ├── agents/
  │   ├── DiagramAgent.ts
  │   └── __tests__/
  ├── types/
  │   └── diagram.ts           # 타입 정의
  ├── utils/
  │   ├── openai.ts           # OpenAI API 통합
  │   └── layoutCalculator.ts  # 레이아웃 계산
  └── App.tsx                 # 앱 진입점
```

## 🧱 기술 스택

### 프론트엔드
- Next.js 14
- React 18
- TypeScript
- TailwindCSS
- next-themes (다크모드)
- react-konva (다이어그램 렌더링)

### 상태 관리
- React Context API
- AgentContext를 통한 중앙 집중식 상태 관리

### 테스트
- Jest
- React Testing Library
- Testing Library User Event
- 컴포넌트 단위 테스트
- 통합 테스트

## 📏 품질 기준

### 성능
- 입력 후 1초 이내 초기 다이어그램 생성
- 60fps 이상의 부드러운 UI 인터랙션
- 메모리 사용량 최적화

### 접근성
- WCAG 2.1 기준 준수
- 키보드 네비게이션 지원
- 스크린 리더 호환성
- 고대비 모드 지원

### 사용성
- 직관적인 UI/UX
- 실시간 피드백
- 에러 상태 명확한 표시
- 반응형 디자인

## 🧪 테스트 전략

### 테스트 범위
- 컴포넌트 단위 테스트
- 통합 테스트
- E2E 테스트
- 성능 테스트

### 테스트 목표
- 코드 커버리지 80% 이상
- 주요 사용자 시나리오 검증
- 성능 지표 달성 확인
- 접근성 기준 충족

## 📈 향후 계획

### 기능 확장
- LLM 통합
- 추가 다이어그램 형식 지원
- 협업 기능
- 실시간 공동 편집

### 성능 최적화
- 렌더링 최적화
- 상태 관리 개선
- 캐싱 전략 구현
- 대규모 다이어그램 처리
